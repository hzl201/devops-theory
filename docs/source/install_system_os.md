
###   安装操作系统

    本安装及设置教程适用于使用Windows2008R2为操作系统的服务器，目的是让服务器实现下列环境。

- 语言脚本环境：ASP.Net4.0
- 数据库环境： MSSQL 2014
- FTP环境：FileZilla\_Server
- 常见组件：

**一、系统准备**

- Windows2008R2原版安装文件、服务器硬件驱动程序(RAID磁盘阵列卡驱动、网卡驱动等)、SQL　SERVER　2014安装盘、FileZilla Server、winpe、rufus、镜像制作GimageX。Windows2008R2和SQL　SERVER　2014安装文件可以购买正版光盘或其他途径获得。Windows2008R2最好是原版，SQL　SERVER　2014可以选择企业版或者标准版。服务器硬件驱动应该在购买服务器的同时附带了。
- FileZilla Server等均可以通过购买或者其他途径来获得。winpe、rufus、GimageX安装文件可以到其官方网站免费下载，或到其他下载网站获得。

**二、系统安装**
    
- 分区：服务器的硬盘推荐1T，分成了3个区，C盘做系统盘(100-200G)，D盘做数据库和软件盘(500G)，E盘做备份盘(300G)，以NTFS格式4K对齐对3个区进行格式化。一般情况下服务器的磁盘阵列已经设置好了，不需要重新设置，可以使用winpe进行分区，只要winpe集成有服务器的磁盘阵列卡驱动，都能正常分区。

- 安装系统：启动服务器，设置BIOS为光盘启动，重启，插入Windows2008R2安装盘至光驱中，根据提示安装操作系统。若没有光盘，可以使用rufus将镜像烧录到U盘，可根据服务器实际情况选择MBR还是UEFI模式，其中最新的服务器一般都是UEFI引导的，烧录完以后需将服务器的RAID磁盘阵列卡驱动解压后、网卡驱动安装包复制到U盘备用。也可以自行将最新的补丁和驱动程序打包到wim镜像中。

- 根据服务器的启动设置选择u盘启动，联想ibm服务器一般是F12，顺利执行U盘引导，若在格式化磁盘的界面发现找不到磁盘，则需要加载RAID磁盘阵列卡驱动，找到U盘对应目录的驱动程序。如图2-1所示。
![](https://s2.ax1x.com/2019/09/23/uP6SZd.png)
- 图2-1 加载RAID磁盘阵列卡驱动

- 设置登录时不弹出“管理您的服务器”窗口：启动计算机，弹出“管理您的服务器”窗口，勾选窗口左下方的“登录时不要显示此页”。

- 启动自动更新：选择初始配置任务--启动自动更新和反馈--启动自动更新和反馈。

- 下载并安装更新：选择初始配置任务--下载并安装更新--更改设置--重要更新--选择下载更新，但是让我选择是否安装更新--确定。

- 修改计算机名：选择初始配置任务--提供计算机名和域--更改--输入计算机名--确定--重启。

- 安装驱动：系统安装更新完毕，进入系统，按照主板-显卡-声卡-网卡-其他设备的顺序安装各类驱动程序。主要是安装网卡驱动，网卡正常后请联系机房管理员配置ip(有可能要绑定网卡MAC地址)并开放端口。

常用端口配置说明：

一张图地图服务：8400

一张图协同服务：8056

一张图文档浏览服务：8405

Web服务:80

SQL SERVER: TCP-1433、UDP-1434

NTP时间同步：UDP-123

**三、安装WEB服务器**

- (1).进入服务器管理器
- (2).选择角色，添加角色
- (3).选择WEB服务器，下一步
- (4).选择除FTP服务器外的所有选项，下一步
- (5).安装

**四、安装.NET3.5功能**

- (1).进入服务器管理器
- (2).选择功能，添加功能
- (3).选择.net　Framework　3.51功能
- (4).下一步，安装

**五、防火墙设置**

默认关闭防火墙。

**六、远程访问服务**

6.1.启动远程访问服务

- (1).选择服务器管理器--启用远程桌面
- (2).选择允许运行任意版本远程桌面的计算机连接(较不安全)。备注：方便多种版本Windows远程管理服务器。
- (3).确定

6.2.修改远程访问服务端口

- (1).在开始--运行菜单里,输入regedit,进入注册表编辑,按下面的路径进入修改端口的地方
- (2).HKEY\_LOCAL\_MACHINE\System\CurrentControlSet\Control\Terminal　Server\WinStations\RDP-Tcp
- (3).找到右侧的　&quot;PortNumber&quot;，用十进制方式显示，默认为3389，改为(例如)6666端口
- (4).HKEY\_LOCAL\_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal　Server\Wds\rdpwd\Tds\tcp
- (5).找到右侧的　&quot;PortNumber&quot;，用十进制方式显示，默认为3389，改为同上的端口
- (6).在控制面板--Windows　防火墙--高级设置--入站规则--新建规则
- (7).选择端口--协议和端口--TCP/特定本地端口：同上的端口
- (8).下一步，选择允许连接
- (9).下一步，选择公用
- (10).下一步，名称：远程桌面-新(TCP-In)，描述：用于远程桌面服务的入站规则，以允许RDP通信。[TCP　同上的端口]
- (11).删除远程桌面(TCP-In)规则
- (12).重新启动计算机

堵住资源共享隐患：打开“本地连接”界面，选择“属性”，左键点击“Microsoft网络客户端”，再点击“卸载”，在弹出的对话框中“是”确认卸载。点击“Microsoft网络的文件和打印机共享”，再点击“卸载”，在弹出的对话框中选择“是”确认卸载。

6.3解除Netbios和TCP/IP协议的绑定：

打开“本地连接”界面，选择“属性”，在弹出的“属性”框中双击“Internet协议版本(TCP/IPV4)”，点击“属性”，再点击“高级”—“WINS”，选择“禁用TCP/IP上的NETBIOS”，点击“确认”并关闭本地连接属性。

禁止默认共享：点击“开始”—“运行”，输入“Regedit”，打开注册表编辑器，打开注册表项“HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\lanmanserver\parameters”，在右边的窗口中新建Dword值，名称设为AutoShareServer，值设为“0”。

**七、虚拟内存设置**

修改虚拟内存的位置或禁用虚拟内存两者选择其一，在内存足够大的情况下可以禁用虚拟内存。如果内存不是非常大，还是修改虚拟内存到硬盘的非系统盘。一般情况下不建议禁用虚拟内存。
 
 - (1)、修改虚拟内存的位置：右键点击“计算机”，选择“属性”—“高级系统设置”—“高级”—“设置”—“高级”—“虚拟内存”—“更改”，取消勾选“自动管理所有驱动器的分页文件大小”，在“驱动器”选择框里面选中系统盘，选择“无分页文件”，在非系统盘如D盘，选择“自定义大小”，输入“初始大小”和“最大值”，点击“设置”，并确认修改。

- (2)、禁用虚拟内存：右键点击“计算机”，选择“属性”—“高级系统设置”—“高级”—“设置”—“高级”—“虚拟内存”—“更改”，取消勾选“自动管理所有驱动器的分页文件大小”，对所有驱动器都选择“无分页文件”，然后点击“设置”并确认修改。

**八、本地安全策略**

- (1)更改管理员账号和来宾账号：本地策略-安全选项-账户，重命名系统管理员账户，把Administrator改名。重命名来宾账户，把Guest用户改名为Administrator，不过是什么权限都没有的那种，然后打开记事本，一阵乱敲，复制，粘贴到"密码"里去。

- (2)组策略：计算机配置—Windows设置—安全设置—本地策略—安全选项交互式登陆：不显示最后的用户名(启用)

- (3)关闭自动播放：
控制面板，自动播放，取消勾选，保存。
点击“开始”—“运行”，输入“Gpedit.msc”，打开组策略编辑器，依次展开“计算机配置”—“管理模板”—“Windows组件”，在右侧窗口找到“自动播放策略”选项并打开，双击右侧关闭自动播放，在打开的对话框上部选择“已启用”，在对话框下部选择“所有驱动器”，点击“确定”完成设置。

**九、开机自动登录设置**

- (1).开始菜单搜索框输入 “netplwiz” 按回车或“Win+R”组合键打开“运行”框内输入“netplwiz”在弹出的“用户帐户”窗口中，把“要使用本机，用户必须输入用户名和密码”前面的复选框中的勾去掉。然后点击“应用”。
![](https://s2.ax1x.com/2019/09/23/uP6wJx.png)

- (2).弹出“自动登录”窗口，输入自己的“用户名”和“密码”，然后点击“确定"回到”用户帐户“窗口；再点击”确定“即可。在下次登录时就会生效。
![](https://s2.ax1x.com/2019/09/23/uPc3tI.png)

**十、启动项设置**

- (1).开始-启动，加入软件快捷方式。

- (2).[Windows Server 2012配置开机启动项](https://www.cnblogs.com/dreamer-fish/p/3504628.html)需使用资源管理器打开这个目录

```shell
C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp
```

**十一、密码免更改设置**

开始-管理工具-计算机管理，系统工具-本地用户和组-用户，在右侧选择administrator，右键属性，更改为密码永不过期。如图11-1所示。
![](https://s2.ax1x.com/2019/09/23/uPcWB4.png)
图11-1 管理员属性设置

**十二、漏洞修复**

操作系统安装好，把所有软件都安装好。优先打高危漏洞。打完重启。

- (1).先补高危漏洞

360高危漏洞免疫工具下载地址：[http://www.360.cn/webzhuanti/mianyigongju.html](http://www.360.cn/webzhuanti/mianyigongju.html)

- (2).再打常规补丁

使用360安全卫士等工具把所有补丁慢慢打上。打完重启。

**十三、病毒查杀**

- (1).安装杀毒软件

操作系统安装好，把所有软件都安装好。安装杀毒软件，并更新病毒库，把自家程序添加到白名单，若查杀出病毒后需要重启再次杀毒。

- (2).升级病毒库

使用杀毒软件定期升级病毒库，保证杀毒效率。

- (3).勒索病毒防治

勒索病毒只能防御，中招之后无法修复，唯一有效的操作就是平时多进行数据异地备份。

**十四、备份系统：**

至此重启服务器，对刚刚做好的操作系统做一个备份。备份推荐用GimageX。
